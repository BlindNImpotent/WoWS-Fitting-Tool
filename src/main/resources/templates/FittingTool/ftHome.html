<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <script>
        //    <![CDATA[
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event:'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-5KDG7W6');
        //    ]]>
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="UTF-8" />
    <link rel="icon" th:href="@{/images/Icon/WoWSFT_Icon.png}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/js/jquery/jquery-ui-1.12.1/jquery-ui.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/FittingTool/FittingTool.css}" />
    <meta name="viewport" content="width=device-width, initial-scale=0.4, user-scalable=yes" />
    <script th:src="@{/js/jquery/jquery-3.2.1.js}"></script>
    <script th:src="@{/js/jquery/jquery-ui-1.12.1/jquery-ui.js}"></script>
    <script th:src="@{/js/accounting/accounting.js}"></script>
    <title>WoWS Fitting Tool by Aesis</title>
</head>
<body>
<noscript>
    //    <![CDATA[
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5KDG7W6" height="0" width="0" style="display:none; visibility:hidden;"></iframe>
    //    ]]>
</noscript>
<header>
    <div th:include="top :: top" id="top">
    </div>
    <div id="shipsList">
        <nav>
            <ul>
                <li th:each="nation : ${nations}">
                    <th:block th:each="eNation : ${encyclopedia.ship_nations}" th:if="${nation.key == eNation.key}">
                        <span th:text="${eNation.value}" />
                    </th:block>
                    <ul>
                        <li th:each="shipType : ${nation.value}">
                            <span th:text="${shipType.key}" />
                            <ul>
                                <li th:each="ship : ${shipType.value}" th:if="${ship.key != 'Test Ship'}">
                                    <span th:with='cleaned=${#strings.replace(ship.key, "&apos;", "&#92;&apos;")}' th:text="${ship.value.tier + ' - ' + ship.key}" th:onclick="'fragments(\'' + ${nation.key} + '\', \'' + ${shipType.key} + '\', \'' + ${cleaned} + '\')'"/>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>
                    <input type="text" id="shortenUrlAddress"/><button id="shortenURL">Shorten URL</button>
                </li>
            </ul>
        </nav>
    </div>
</header>
<main id="main">
    <div class="warshipData" th:include="FittingTool/ftShipSelect :: warshipStats"></div>
    <div class="shipAPIData" style="display: none;">
    </div>
</main>
<script th:inline="javascript">
    //    <![CDATA[
    var height1 = document.getElementById('top').clientHeight;
    var height2 = document.getElementById('shipsList').clientHeight;

    var nation = '';
    var shipType = '';
    var ship = '';
    var mobile = false;

    var modules = [];
    var upgrades = [];
    var skills = [];
    var oSkills = [];
    var uSkills = [];
    var flags = [];
    var consumables = [[${consumables}]];

    var nThM = '';

    var camouflage = false;

    var shipHP = 0;

    var maxFlagPts = 8;

    var adrenalineValue = 100;

    var commander = [[${sCommander}]] !== null ? [[${sCommander}]] : 'default';

    var live = [[${serverParam}]];

    var waitTime = 1000;
    var timer;
    var rightPanelOpen = '';

    $().ready(function () {
        $( function() {
            $('#shipList').menu();
        });

        if ([[${url}]] != null)
        {
            adrenalineValue = [[${adrenalineValue}]];
            callAPI();
            setCaptainSkillPoints();
            setFlags();
            changeSkillDescription();
        }
    });

    $(document).on('click', '.button_module', function(){
        var clickedId = $(this).attr('id');
        var selectedModules = document.getElementsByName($(this).attr('name'));

        for (var i = 0; i < selectedModules.length; i++)
        {
            var buttonId = selectedModules[i].getAttribute('id').replace('li_', '');
            document.getElementById(buttonId).className = 'button_module';
        }
        document.getElementById(clickedId).className = 'button_module_selected';

        delayCall();
    });

    $(document).on('click', '.button_upgrade, .button_upgrade_selected', function () {
        var clickedId = $(this).attr('id');

        if (document.getElementById(clickedId).className == 'button_upgrade')
        {
            var gParentElem = $(this).parent().parent();
            var parents = gParentElem.children();

            for (var i = 0; i < parents.length; i++)
            {
                var buttonId = parents[i].getAttribute('id').replace('li_', '');
                document.getElementById(buttonId).className = 'button_upgrade';
            }
            document.getElementById(clickedId).className = 'button_upgrade_selected';
        }
        else
        {
            document.getElementById(clickedId).className = 'button_upgrade';
        }

        delayCall();
    });

    function setCaptainSkillPoints()
    {
        var list = $('.button_skill_selected');

        var maxSpts = 19;
        var totalSpts = 0;

        for (var i = 0; i < list.length; i++)
        {
            var current = list.eq(i);

            totalSpts = totalSpts + parseInt(current.attr('tier'));
        }

        $('#totalSkillPoints').text('Skill Points ' + totalSpts.toString() + ' / ' + maxSpts.toString());
    }

    function setFlags()
    {
        var list = $('.button_flag_selected');

        if ([[${shipType}]] != null && [[${shipType}]] == 'AirCarrier')
        {
            maxFlagPts = 4;
        }

        var totalPts = list.length;

        $('#totalFlagsCount').text('Flags ' + totalPts.toString() + ' / ' + maxFlagPts.toString());
    }

    function setConsumables()
    {
        var list = [[${consumables}]];

        if (list == null || ([[${warship}]] != null && [[${warship}]].name != ship))
        {
            list = [];
        }

        var notSelected = $('.button_consumable');
        var selected = $('.button_consumable_selected');

        if (selected.length > 0)
        {
            list = [];

            for (var i = 0; i < selected.length; i++)
            {
                list.push(selected.eq(i).attr('name'));
            }
        }

        var allConsumables = [];
        for (var i = 0; i < notSelected.length; i++)
        {
            allConsumables.push(notSelected.eq(i).attr('name'));
        }
        for (var i = 0; i < selected.length; i++)
        {
            allConsumables.push(selected.eq(i).attr('name'));
        }

        for (var i = 0; i < list.length; i++)
        {
            var mismatch = true;

            for (var j = 0; j < allConsumables.length; j++)
            {
                if (list[i] == allConsumables[j])
                {
                    mismatch = false;
                    break;
                }
            }

            if (mismatch)
            {
                list = [];
                break;
            }
        }

        consumables = [];
        for (var i = 0; i < list.length; i++)
        {
            var current = list[i];
            var abil = $('[name=' + current + ']').attr('class').split(' ')[1];

            $('[name=' + current + ']').attr('class', 'button_consumable_selected ' + abil);
            consumables.push(current);
            $('#' + current).removeAttr('style');
        }

        if ($('.button_consumable_selected').length == 0)
        {
            var abil0List = $('.abil0');
            var abil1List = $('.abil1');
            var abil2List = $('.abil2');
            var abil3List = $('.abil3');

            if (abil0List.length !== 0)
            {
                abil0List.eq(0).attr('class', 'button_consumable_selected abil0');
                $('#' + abil0List.eq(0).attr('name')).removeAttr('style');
            }

            if (abil1List.length !== 0)
            {
                abil1List.eq(0).attr('class', 'button_consumable_selected abil1');
                $('#' + abil1List.eq(0).attr('name')).removeAttr('style');
            }

            if (abil2List.length !== 0)
            {
                abil2List.eq(0).attr('class', 'button_consumable_selected abil2');
                $('#' + abil2List.eq(0).attr('name')).removeAttr('style');
            }

            if (abil3List.length !== 0)
            {
                abil3List.eq(0).attr('class', 'button_consumable_selected abil3');
                $('#' + abil3List.eq(0).attr('name')).removeAttr('style');
            }
        }

        history.replaceState({
            nation: nation,
            shipType: shipType,
            ship: ship
        }, nation + shipType + ship, '/warship?nation=' + nation + '&shipType=' + shipType + '&ship=' + encodeURIComponent(ship) + '&moduleN=' + nThM + '&upgrades=' + encodeURIComponent(upgrades) + '&flags=' + encodeURIComponent(flags) + '&skillsH=' + encodeURIComponent(skills) + '&camo=' + camouflage + '&consumables=' + encodeURIComponent(consumables) + '&adrenalineValue=' + $('#custom-handle').text() + '&commander=' + encodeURIComponent(commander) + '&uSkillsH=' + encodeURIComponent(uSkills));
    }

    $(document).on('click', '.button_skill, .button_skill_selected', function () {
        var maxSpts = 19;
        var currentSpts = 0;
        var clickedSpts = 0;
        var totalSpts = 0;

        var clickedId = $(this).attr('id');

        if (document.getElementById(clickedId).className == 'button_skill')
        {
            clickedSpts = clickedSpts + parseInt($(this).attr('tier'));
        }
        else
        {
            clickedSpts = clickedSpts - parseInt($(this).attr('tier'));
        }

        var selected = document.getElementsByClassName('button_skill_selected');

        for (var i = 0; i < selected.length; i++)
        {
            currentSpts = currentSpts + parseInt(selected[i].getAttribute('tier'));
        }

        totalSpts = totalSpts + currentSpts + clickedSpts;

        if (document.getElementById(clickedId).className == 'button_skill')
        {
            if (totalSpts > maxSpts)
            {
                return false;
            }
            document.getElementById(clickedId).className = 'button_skill_selected';
        }
        else
        {
            document.getElementById(clickedId).className = 'button_skill';
        }

        $('#totalSkillPoints').text('Skill Points ' + totalSpts.toString() + ' / ' + maxSpts.toString());

        delayCall();
    });

    $(document).on('click', '.button_uSkill, .button_uSkill_selected', function () {
        var clickedId = $(this).attr('id');

        if (document.getElementById(clickedId).className == 'button_uSkill')
        {
            document.getElementById(clickedId).className = 'button_uSkill_selected';
        }
        else
        {
            document.getElementById(clickedId).className = 'button_uSkill';
        }

        delayCall();
    });

    $(document).on('click', '.button_flag, .button_flag_selected', function () {
        var maxFlags = maxFlagPts;

        var clickedId = $(this).attr('id');
        var selected = document.getElementsByClassName('button_flag_selected');

        if (document.getElementById(clickedId).className == 'button_flag')
        {
            if (selected.length >= maxFlags)
            {
                return false;
            }
            document.getElementById(clickedId).className = 'button_flag_selected';
        }
        else
        {
            document.getElementById(clickedId).className = 'button_flag';
        }

        $('#totalFlagsCount').text('Flags ' + selected.length.toString() + ' / ' + maxFlags.toString());

        delayCall();
    });

    $(document).on('click', '#showCrewSkills', function () {
        $('#crewSkills').dialog('open');
    });

    $(document).on('click', '#showFlags', function () {
        $('#flags').dialog('open');
    });

    $(document).on('click', '#showConsumables', function () {
        $('#consumablesData').dialog('open');
    });

    $(document).on('click', '#showTorpVisibilityDialog', function () {
        $('#torpVisibilityDialog').dialog('open');
    });

    $(document).on('click', '#showArtillerySector', function () {
        $('#artilleryCanvasDiv').dialog('open');
    });

    $(document).on('click', '#showTorpedoSector', function () {
        $('#torpedoesCanvasDiv').dialog('open');
    });

    //    $(document).on('click', '#showCamouflage', function () {
    //        $('#camouflage').dialog('open');
    //    });

    $(document).on('click', '#camouflageCheckbox', function () {
        delayCall();
    });

    function delayCall()
    {
        window.clearTimeout(timer);
        timer = window.setTimeout(function() {
            callAPI();
        }, waitTime);
    }

    function callAPI()
    {
        if ($('#ship').attr('name') != null)
        {
            if (nation == '' || shipType == '' || ship == '')
            {
                if ([[${warship}]] != null)
                {
                    nation = [[${warship}]]['nation'];
                    shipType = [[${warship}]]['type'];
                    ship = [[${warship}]]['name'];
//                    ship = ship.replace("'", "");
                }
                else
                {
                    return false;
                }
            }

            var url = live + '/shipAPI?nation=' + nation + '&shipType=' + shipType + '&ship=' + encodeURIComponent(ship) + '&ship_id=' + $('#ship').attr('name');
            var modifier = '&';
            var equals = '=';

            var selectedModules = $('.button_module_selected');
            var selectedUpgrades = $('.button_upgrade_selected');
            var selectedSkills = $('.button_skill_selected');
            var selectedUSkills = $('.button_uSkill_selected');
            var selectedFlags = $('.button_flag_selected');
            var selectedConsumables = $('.button_consumable_selected');

            modules = [];
            upgrades = [];
            oSkills = [];
            skills = [];
            uSkills = [];
            flags = [];
            consumables = [];
            nThM = '';

            camouflage = [$('#camouflageCheckbox').is(':checked')];

            var tempSMArray = [];
            for (var i = 0; i < selectedModules.length; i++)
            {
                var mIndex = selectedModules.eq(i).attr('data-index');
                var rowPos = selectedModules.eq(i).attr('data-position');
                tempSMArray[rowPos] = mIndex;
            }
            for (var i = 0; i < tempSMArray.length; i++) {
                if (tempSMArray[i] !== undefined && tempSMArray !== null) {
                    nThM = nThM + tempSMArray[i].toString();
                }
            }
            url = url + '&moduleN=' + nThM;

            for (var i = 0; i < selectedUpgrades.length; i++)
            {
                var upgradeId = selectedUpgrades[i].getAttribute('id');

                upgrades.push(upgradeId);
            }

            for (var i = 0; i < selectedSkills.length; i++)
            {
                var tier = selectedSkills[i].getAttribute('tier');
                var type_id = selectedSkills[i].getAttribute('type_id');

                var current = {
                    tier: tier,
                    type_id: type_id
                };
                oSkills.push(current);
                skills.push(tier + '_' + type_id);
            }

            for (var i = 0; i < selectedUSkills.length; i++)
            {
                var id = selectedUSkills[i].getAttribute('id');

                uSkills.push(id);
            }

            for (var i = 0; i < selectedFlags.length; i++)
            {
                var flagId = selectedFlags[i].getAttribute('id');

                flags.push(flagId);
            }

            for (var i = 0; i < selectedConsumables.length; i++)
            {
                var consumableId = selectedConsumables.eq(i).attr('name');
                consumables.push(consumableId);
            }

            var upgradesSkills = {
                upgrades: upgrades,
                skills: oSkills,
                uSkills: uSkills,
                camouflage: camouflage,
                flags: flags,
                consumables: consumables,
                commander: [commander]
            };

            url = url + '&adrenalineValue=' + adrenalineValue;

            url = url + '&upgradeCompare=' + $('#upgradeCompareCheckBox').is(':checked');

            url = url + '&stockCompare=' + $('#stockCompareCheckBox').is(':checked');

            url = url + '&mobile=false';

            $.ajax({
                url: url,
                type: 'post',
                contentType: "application/json",
                data: JSON.stringify(upgradesSkills),
                success: function (data) {
                    if (data != '')
                    {
                        $('.right_side').html(data);
                        $('#consumables').html($('#consumablesDataFragment').html());
                        $('#consumablesDataFragment').remove();

                        setConsumables();
                        showPanelRight(rightPanelOpen);

//                        $.ajax({
//                            url: url.replace('shipAPI', 'shipComponents'),
//                            type: 'post',
//                            contentType: "application/json",
//                            data: JSON.stringify(upgradesSkills),
//                            success: function (data) {
//                                if (data != '')
//                                {
//                                    $('#consumablesData').replaceWith(data);
//
//                                    setConsumables();
//                                }
//                                else
//                                {
////                                    alert('Consumable Error');
//                                }
//                            }
//                        });
                        history.replaceState({
                            nation: nation,
                            shipType: shipType,
                            ship: ship
                        }, nation + shipType + ship, live + '/WarshipStats?nation=' + nation + '&shipType=' + shipType + '&ship=' + encodeURIComponent(ship) + '&moduleN=' + nThM + '&upgrades=' + encodeURIComponent(upgrades) + '&flags=' + encodeURIComponent(flags) + '&skillsH=' + encodeURIComponent(skills) + '&camo=' + camouflage + '&consumables=' + encodeURIComponent(consumables) + '&adrenalineValue=' + adrenalineValue + '&commander=' + encodeURIComponent(commander) + '&uSkillsH=' + encodeURIComponent(uSkills));
                    }
                    else
                    {
                        var html = '<div class="shipAPIData" id="shipAPIData"><h2>Wrong path of research</h2></div>';

                        $('.shipAPIData').replaceWith(html);
                    }
                }
            });
        }
    }

    function fragments(nationOriginal, shipTypeOriginal, shipOriginal)
    {
        rightPanelOpen = '';
        nation = nationOriginal.replace(/ /g, '+');
        shipType = shipTypeOriginal.replace(/ /g, '+');
        ship = shipOriginal.replace(/ /g, '+');

        var url = live + '/warship?nation=' + nation + '&shipType=' + shipType + '&ship=' + encodeURIComponent(ship);

        $.ajax({
            url: url,
            type: 'post',
            success: function (data) {
                $('.button_skill_selected').attr('class', 'button_skill');
                $('.button_uSkill_selected').attr('class', 'button_uSkill');
                $('.button_flag_selected').attr('class', 'button_flag');
                $('.button_consumable_selected').attr('class', 'button_consumable');

                $('.warshipData').replaceWith(data);

                $('.button_uSkill_selected').attr('class', 'button_uSkill');
                $('#uniqueSkillsTable').find('tr').hide();
                $('#uniqueSkillsTable').hide();

                commander = 'default';
                $('#commanderSelect').val(commander);
                changeSkillDescription();

                callAPI();
            }
        });
    }

    $(window).on('popstate', function () {
        history.go(document.location);
    });

    $(document).on('click', '#shortenURL', function () {
        var longUrl = encodeURIComponent(window.location.href);

        $.ajax({
            url: '/shortenUrl',
            type: 'post',
            contentType: "application/json",
            data: longUrl,
            success: function (data) {
                $('#shortenUrlAddress').val(data);
            },
            error: function (data) {
                console.log(data);
            }
        });
    });

    $(document).on('click', '#stockCompareCheckBox, #upgradeCompareCheckBox', function ()
    {
        var clickedId = $(this).attr('id');
        var clicked = $(this).is(':checked');
        var comparisonList = $('[name=comparison]');

        for (var i = 0; i < comparisonList.length; i++)
        {
            var current = comparisonList.eq(i);

            if (current.attr('id') !== clickedId && clicked)
            {
                current.prop('checked', !clicked)
            }
        }

        delayCall();
    });

    $(document).on('click', '#changeDevice', function () {
        mobile = true;

        var url = window.location.href;

        if (url.includes('mobile'))
        {
            url = url.replace('mobile=false', 'mobile=' + mobile);
        }
        else
        {
            if (url.includes('warship'))
            {
                url = url + '&mobile=' + mobile;
            }
            else
            {
                url = url + '?mobile=' + mobile;
            }
        }

        location.href = url;
    });

    $(document).on('click', '.button_consumable', function () {
        var id = $(this).attr('name');
        var abil = $(this).attr('class').split(' ')[1];
        var abilDot = '.' + abil;

        $('.consumablesStats' + abilDot).attr('style', 'display: none;');
        $('.button_consumable_selected' + abilDot).attr('class', 'button_consumable ' + abil);

        $('#' + id).removeAttr('style');
        $('[name=' + id + ']').attr('class', 'button_consumable_selected ' + abil);

        var selectedConsumables = $('.button_consumable_selected');
        consumables = [];
        for (var i = 0; i < selectedConsumables.length; i++)
        {
            var consumableId = selectedConsumables[i].getAttribute('name');

            consumables.push(consumableId);
        }

        history.replaceState({
            nation: nation,
            shipType: shipType,
            ship: ship
        }, nation + shipType + ship, live + '/WarshipStats?nation=' + nation + '&shipType=' + shipType + '&ship=' + encodeURIComponent(ship) + '&moduleN=' + nThM + '&upgrades=' + encodeURIComponent(upgrades) + '&flags=' + encodeURIComponent(flags) + '&skillsH=' + encodeURIComponent(skills) + '&camo=' + camouflage + '&consumables=' + encodeURIComponent(consumables) + '&adrenalineValue=' + adrenalineValue + '&commander=' + encodeURIComponent(commander) + '&uSkillsH=' + encodeURIComponent(uSkills));
    });

    $(document).on('change', '#commanderSelect', function ()
    {
        commander = $('#commanderSelect').val();
        var tempCommander = commander.replace(' ', '');
        uSkills = [];

        $('.button_uSkill_selected').attr('class', 'button_uSkill');
        $('#uniqueSkillsTable').find('tr').hide();
        $('#uniqueSkillsTable').hide();
        var commanderUSkills = $('#uniqueSkillsTable').find('tr');
        for (var i = 0; i < commanderUSkills.length; i++)
        {
            var currentId = commanderUSkills.eq(i).attr('id');
            if (tempCommander === currentId)
            {
                $('#' + tempCommander).show();
                $('#uniqueSkillsTable').show();
                break;
            }
        }

        changeSkillDescription();

        history.replaceState({
            nation: nation,
            shipType: shipType,
            ship: ship
        }, nation + shipType + ship, live + '/WarshipStats?nation=' + nation + '&shipType=' + shipType + '&ship=' + encodeURIComponent(ship) + '&moduleN=' + nThM + '&upgrades=' + encodeURIComponent(upgrades) + '&flags=' + encodeURIComponent(flags) + '&skillsH=' + encodeURIComponent(skills) + '&camo=' + camouflage + '&consumables=' + encodeURIComponent(consumables) + '&adrenalineValue=' + adrenalineValue + '&commander=' + encodeURIComponent(commander) + '&uSkillsH=' + encodeURIComponent(uSkills));

//        if ($('.button_skill_selected').length > 0)
//        {
        delayCall();
//        }
    });

    function changeSkillDescription()
    {
        if (commander === 'John Doe')
        {
            $('#1_2').attr('title', '-75% to reload time when the shell type is switched');
            $('#2_2').attr('title', '+3.0deg/s to traverse speed of guns with a caliber up to 139 mm\n+1.0deg/s to traverse speed of guns with a caliber above 139 mm');
        }
        else if (commander === 'Jack Dunkirk')
        {
            $('#2_1').attr('title', '-10% to reload time of all mounted consumables');
            $('#2_2').attr('title', '+3.0deg/s to traverse speed of guns with a caliber up to 139 mm\n+1.0deg/s to traverse speed of guns with a caliber above 139 mm');
            $('#2_4').attr('title', '+30% to the radius of the smoke screen');
        }
        else if (commander === 'Jean-Jacques Honor√©')
        {
            $('#2_2').attr('title', '+3.0deg/s to traverse speed of guns with a caliber up to 139 mm\n+1.0deg/s to traverse speed of guns with a caliber above 139 mm');
            $('#2_6').attr('title', '-0.25% to reload time of all types of armament for each 1% HP lost');
        }
        else if (commander === 'default')
        {
            $('#1_2').attr('title', '-50% to reload time when the shell type is switched');
            $('#2_1').attr('title', '-5% to reload time of all mounted consumables');
            $('#2_2').attr('title', '+2.5deg/s to traverse speed of guns with a caliber up to 139 mm\n+0.7deg/s to traverse speed of guns with a caliber above 139 mm');
            $('#2_4').attr('title', '+20% to the radius of the smoke screen');
        }
    }

    //    $(window).scroll(function () {
    //        var position = document.getElementById('main').getBoundingClientRect().top;
    //
    //        if (position < height2)
    //        {
    //            $('#top').hide();
    //            if ($('#shipsList').attr('style') === undefined)
    //            {
    //                $('#shipsList').attr('style', 'top: 0; position: fixed; width: 100%;');
    //                $('#main').attr('style', 'margin-top: ' + height1 + 'px;')
    //            }
    //        }
    //        else if (position === height1 && $('#shipsList').attr('style') !== undefined)
    //        {
    //            $('#top').show();
    //            if ($('#shipsList').attr('style') !== undefined)
    //            {
    //                $('#shipsList').removeAttr('style');
    //                $('#main').removeAttr('style');
    //            }
    //        }
    //    });

    function showPanelLeft(type) {
        var tabs = $('.button_tab.left');
        for (var i = 0; i < tabs.length; i++)
        {
            var current = tabs.eq(i);
            current.removeClass('select');
        }
        $('#tab_left_' + type).addClass('select');

        var panels = $('.panel_left');
        for (var i = 0; i < panels.length; i++)
        {
            var current = panels.eq(i);
            current.addClass('hide');
        }
        $('#' + type).removeClass('hide');
    }

    function showPanelRight(type) {
        if (type === '') {
            return false;
        }

        var tabs = $('.button_tab.right');
        for (var i = 0; i < tabs.length; i++)
        {
            var current = tabs.eq(i);
            current.removeClass('select');
        }
        $('#tab_right_' + type).addClass('select');

        var panels = $('.panel_right');
        for (var i = 0; i < panels.length; i++)
        {
            var current = panels.eq(i);
            current.addClass('hide');
        }
        $('#' + type + 'Stats').removeClass('hide');

        rightPanelOpen = type;
    }

    //    ]]>
</script>
</body>
</html>