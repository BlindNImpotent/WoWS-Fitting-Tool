<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" th:href="@{/js/jquery/jquery-ui-1.12.1/jquery-ui.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/ShipStyle.css}" />
    <script th:src="@{/js/jquery/jquery-1.12.4.js}"></script>
    <script th:src="@{/js/jquery/jquery-ui-1.12.1/jquery-ui.js}"></script>
    <script th:src="@{/js/accounting/accounting.js}"></script>
    <title>WoWS Fitting Tool by Aesis</title>
</head>
<body>
<header>
    <div id="header">
        <div id="dropDownList">
            <ul id="shipList">
                <li th:each="nation : ${data.nations}">
                    <span th:text="${nation.key}" />
                    <ul>
                        <li th:each="shipType : ${nation.value}">
                            <span th:text="${shipType.key}" />
                            <ul>
                                <li th:each="ship : ${shipType.value}">
                                    <span th:text="${ship.key}" th:onclick="'fragments(\'' + ${nation.key} + '\', \'' + ${shipType.key} + '\', \'' + ${ship.key} + '\')'"/>
                                    <!--<a th:text="${ship.key}" th:href="@{'#warship'(nation=${nation.key}, shipType=${shipType.key}, ship=${ship.key})}"/>-->
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</header>
<main>
    <div class="container">
        <div class="warshipData">
        </div>
        <div class="shipAPIData">
        </div>
    </div>
</main>
<script th:inline="javascript">
//    <![CDATA[

    $().ready(function () {
        $( function() {
            $('#shipList').menu();
        });
    });

    $(document).on('click', '.button_module', function(){
        var clickedId = $(this).attr('id');
        var gParentElem = $(this).parent().parent();
        var parents = gParentElem.children();

        for (var i = 0; i < parents.length; i++)
        {
            var buttonId = parents[i].getAttribute('id').replace('li_', '');
            document.getElementById(buttonId).className = 'button_module';
        }
        document.getElementById(clickedId).className = 'button_module_selected';

        callAPI();
    });

    $(document).on('click', '.button_upgrade, .button_upgrade_selected', function () {
        var clickedId = $(this).attr('id');

        if (document.getElementById(clickedId).className == 'button_upgrade')
        {
            var gParentElem = $(this).parent().parent();
            var parents = gParentElem.children();

            for (var i = 0; i < parents.length; i++)
            {
                var buttonId = parents[i].getAttribute('id').replace('li_', '');
                document.getElementById(buttonId).className = 'button_upgrade';
            }
            document.getElementById(clickedId).className = 'button_upgrade_selected';
        }
        else
        {
            document.getElementById(clickedId).className = 'button_upgrade';
        }

        callAPI();
    });

    function callAPI()
    {
        if ($('#ship').attr('name') != null)
        {
            var url = '/shipAPI?ship_id=' + $('#ship').attr('name');
            var modifier = '&';
            var equals = '=';

            var selectedModules = $('.button_module_selected');
            var selectedUpgrades = $('.button_upgrade_selected');

            for (var i = 0; i < selectedModules.length; i++)
            {
                var type = selectedModules[i].getAttribute('name');
                var moduleId = selectedModules[i].getAttribute('id');

                url = url + modifier + type + equals + moduleId;
            }

            for (var i = 0; i < selectedUpgrades.length; i++)
            {
                var type = selectedUpgrades[i].getAttribute('name');
                var upgradeId = selectedUpgrades[i].getAttribute('id');

                url = url + modifier + type + equals + upgradeId;
            }

            $.ajax({
                url: url,
                type: 'get',
                success: function (data) {
                    if (data != '')
                    {
                        $('.shipAPIData').replaceWith(data);
                    }
                    else
                    {
                        alert('Wrong path of research!');
                    }
                }
            });
        }
    }

    function fragments(nationOriginal, shipTypeOriginal, shipOriginal)
    {
        var nation = nationOriginal.replace(/ /g, '+');
        var shipType = shipTypeOriginal.replace(/ /g, '+');
        var ship = shipOriginal.replace(/ /g, '+');

        var url = '/warship?nation=' + nation + '&shipType=' + shipType + '&ship=' + ship;

        $.ajax({
            url: url,
            type: 'get',
            success: function (data) {
                $('.warshipData').replaceWith(data);
                callAPI();
            }
        });
    }

//    ]]>
</script>
</body>
</html>